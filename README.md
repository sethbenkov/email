# Daily Email Brief Automation - Python Components

This project contains the Python scripts designed to fetch data from various sources (Google Calendar, Gmail, Zoom meeting summaries, locally exported OneNote files) to generate a daily briefing email. These scripts are intended to be used within Zapier's "Code by Zapier" steps but can be run locally for testing.

## Project Structure

```
.
├── .env.example             # Example environment variables (rename to .env)
├── .gitignore               # Files to ignore in git
├── config.py                # Configuration constants and settings
├── email_composer.py        # Composes the final HTML email using Jinja2
├── email_template.html      # Jinja2 template for the email
├── gmail_fetcher.py         # Fetches email snippets from Gmail
├── google_calendar_fetcher.py # Fetches calendar events from Google Calendar
├── main.py                  # Orchestrates local testing of fetchers and composer
├── onenote_parser.py        # Parses locally exported OneNote (.docx) files
├── requirements.txt         # Python dependencies
├── utils.py                 # Utility functions (authentication, date/time)
├── zoom_parser.py           # Parses Zoom meeting summary HTML/text files
├── credentials.json         # Downloaded from Google Cloud (DO NOT COMMIT)
├── token.json               # Generated by Google Auth flow (DO NOT COMMIT)
└── daily_brief_local_output.html # Example output from local run
```

## Setup

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd <repository_directory>
    ```

2.  **Create a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```

3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Configure Google Credentials:**
    *   Follow the steps in the Google Cloud Console to create a project, enable the Calendar and Gmail APIs, configure the OAuth Consent Screen (adding your email as a Test User), and create **OAuth 2.0 Client ID credentials for a Desktop App**.
    *   Download the credentials JSON file and save it in the project root directory as `credentials.json`. **Do not commit this file.**

5.  **Configure Local Folder Paths:**
    *   Rename `.env.example` to `.env`.
    *   Open the `.env` file and ensure the paths for `ONENOTE_EXPORT_FOLDER` and `ZOOM_SUMMARY_FOLDER` point to the correct locations on your local machine where the OneNote `.docx` exports and Zoom summary files will be stored.

## Manual Daily Steps

*   **Export OneNote Tasks:** Before running the script (or before 7 AM ET for the final Zap), you MUST manually export the relevant OneNote page(s) or section(s) containing your tasks as a **Word Document (`.docx`)** file into the folder specified by `ONENOTE_EXPORT_FOLDER` in your `.env` file.
*   **Mark Completed Tasks:** In OneNote, mark completed tasks by typing `DONE ` (case-insensitive) at the very beginning of the task line before exporting.

## Running Locally for Testing

This runs the data fetching and composition steps locally, producing an HTML preview file (`daily_brief_local_output.html`). It does **not** call the OpenAI API, send emails, or post to Slack.

1.  **First Run (Google Authentication):**
    *   The first time you run the script, it will likely open your web browser for Google authentication (to authorize access to Calendar and Gmail). You'll need to select the account specified as a Test User and approve the permissions.
    *   Successful authentication will create `token.json` so you don't have to re-authenticate each time.

2.  **Ensure Exported File Exists:** Make sure you have manually exported a `.docx` file from OneNote into the designated folder.

3.  **Execute the main script:**
    ```bash
    python main.py
    ```

4.  **Check Output:**
    *   Look for log messages in the terminal indicating success or errors for each step, including the parsing of the OneNote `.docx` file.
    *   Open `daily_brief_local_output.html` in your browser to see the composed email structure.

## Scheduling

To automate running this script every weekday at 7 AM ET, use your operating system's task scheduler. For example:

### Windows Task Scheduler
1. Open **Task Scheduler**.
2. Create a **Basic Task** and name it (e.g., "Daily Brief").
3. Trigger: **Weekly**, select **Monday–Friday** at **7:00 AM**.
4. Action: **Start a program**.
   - **Program/script**: `python`
   - **Add arguments**: `"%USERPROFILE%\DailyEmail\main.py"`
   - **Start in**: `%USERPROFILE%\DailyEmail`
5. Finish the wizard. Ensure your virtual environment is activated within the script or call your `venv\Scripts\activate` first.

### macOS / Linux (cron)
1. Open a terminal and run `crontab -e`.
2. Add a line:
   ```cron
   0 7 * * 1-5 /usr/bin/env bash -lc 'cd ~/DailyEmail && source venv/bin/activate && python main.py'
   ```
3. Save and exit. This runs the script at 7:00 every weekday.

Remove the old Zapier integration instructions since this repository now runs entirely on your local machine. 